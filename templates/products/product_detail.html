{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} | A&M Signature{% endblock %}

{% block content %}
<div class="container my-4">

  <a href="{% url 'products:product_list' %}" class="btn btn-outline-dark btn-sm mb-3">
    ← Back to Collection
  </a>

  <div class="row g-4 align-items-start">

    <!-- IMAGE -->
    <div class="col-4 text-center">
      {% if product.image %}
        <img src="{{ product.image.url }}"
             class="img-fluid rounded product-detail-img"
             alt="{{ product.name }}">
      {% else %}
        <img src="https://via.placeholder.com/500x500?text=No+Image"
             class="img-fluid rounded product-detail-img"
             alt="No image">
      {% endif %}
    </div>

    <!-- DETAILS -->
    <div class="col-md-7">
      <h4 class="mb-1">{{ product.name }}</h4>
      <p class="fw-bold fs-5 mb-2">€{{ product.price }}</p>
      <p class="text-muted">{{ product.description }}</p>

      {% if user.is_authenticated %}

        <!-- ✅ One form: size + add-to-cart -->
        <form method="post" action="{% url 'orders:add_to_cart' product.id %}" class="mt-3">
          {% csrf_token %}

          {% if product.has_sizes %}
            <label class="fw-semibold d-block mb-2">Select Size</label>

            <div class="d-flex gap-2 flex-wrap">
              {% for s in sizes %}
                <input type="radio"
                       class="btn-check"
                       name="size"
                       id="size-{{ s.id }}"
                       value="{{ s.size }}"
                       {% if s.stock <= 0 %}disabled{% endif %}
                       required>

                <label class="btn {% if s.stock <= 0 %}btn-outline-secondary{% else %}btn-outline-dark{% endif %}"
                       for="size-{{ s.id }}">
                  {{ s.size }}{% if s.stock <= 0 %} (Out){% endif %}
                </label>
              {% empty %}
                <p class="text-muted mb-0">No sizes added for this product.</p>
              {% endfor %}
            </div>

          {% endif %}

          <div class="d-flex gap-2 mt-4">
            <button type="submit" class="btn btn-gold">
              <i class="bi bi-cart fs-5"></i>
            </button>

            <a href="{% url 'products:add_to_wishlist' product.id %}" class="btn btn-outline-gold">
              <i class="bi bi-heart fs-5"></i>
            </a>
          </div>
        </form>

      {% else %}
        <div class="d-flex gap-2 mt-4">
          <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-gold">
            <i class="bi bi-cart fs-5"></i>
          </a>
          <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-outline-gold">
            <i class="bi bi-heart fs-5"></i>
          </a>
        </div>
      {% endif %}

    </div>
  </div>
</div>
{% endblock %}
